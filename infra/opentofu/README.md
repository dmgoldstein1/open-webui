# OpenTofu IaC for LLM Gateway (Local Dev)

Generated by Copilot (OpenAI)

This configuration provisions local infrastructure for the gateway/queue project:

- Starts LocalStack (SQS, API Gateway, IAM, etc.) and DynamoDB Local containers (optional)
- Creates two SQS queues (default and priority) in LocalStack
- Creates a DynamoDB table `Conversations` in DynamoDB Local
- Exposes outputs for wiring env vars: queue URLs and endpoints

## Usage

```bash
cd infra/opentofu
# Initialize and apply
tofu init
tofu apply -auto-approve

# Export env vars for llm-gateway
export AWS_REGION=us-east-1
export AWS_ACCESS_KEY_ID=test
export AWS_SECRET_ACCESS_KEY=test
export SQS_ENDPOINT_URL=http://localhost:4566
export DYNAMODB_ENDPOINT_URL=http://localhost:8000
export SQS_QUEUE_URL=$(tofu output -raw sqs_default_queue_url)
export SQS_PRIORITY_QUEUE_URL=$(tofu output -raw sqs_priority_queue_url)
export DDB_TABLE=Conversations

# Run local API and worker
npm --prefix ../../llm-gateway install
node ../../llm-gateway/src/local/server.js &
node ../../llm-gateway/src/worker/worker.js
```

## Deploying to AWS (example)

The `main.tf` includes commented-out resources showing how to switch to real AWS. Uncomment the provider and resources, set proper credentials, and apply in a non-local environment.
